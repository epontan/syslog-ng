FROM centos:7
MAINTAINER Andras Mitzki <andras.mitzki@balabit.com>

RUN yum install -y wget epel

#RUN wget -qO - http://download.opensuse.org/repositories/home:/laszlo_budai:/syslog-ng/xUbuntu_17.04/Release.key | apt-key add -
#RUN echo 'deb http://download.opensuse.org/repositories/home:/laszlo_budai:/syslog-ng/xUbuntu_17.04 ./' | tee --append /etc/apt/sources.list.d/syslog-ng-obs.list


ADD dev-dependencies.txt .
RUN cat dev-dependencies.txt | grep -v "#" | xargs yum -y  install

RUN yum install -y epel-release

RUN cd /etc/yum.repos.d && wget https://copr.fedorainfracloud.org/coprs/czanik/syslog-ng39/repo/epel-7/czanik-syslog-ng39-epel-7.repo

#
# if you want to add further packages, add them to addons.txt to make image
# creation faster.  If you are done, move them to dev-dependencies and leave
# addons.txt empty.  The image creation will be faster, as the results of
# the original dev-dependencies will be reused by docker.
#
ADD addons.txt .
RUN cat addons.txt | grep -v "#" | xargs -r yum -y install

RUN yum install -y mongo-c-driver-devel

ADD gosu.pubkey /tmp
# grab gosu for easy step-down from root
RUN (cat /tmp/gosu.pubkey | gpg --import) \
    && wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64" \
    && wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64.asc" \
    && gpg --verify /usr/local/bin/gosu.asc \
    && rm /usr/local/bin/gosu.asc \
    && chmod +x /usr/local/bin/gosu


ADD entrypoint.sh /
ENTRYPOINT ["/entrypoint.sh"]
RUN mkdir /source
VOLUME /source
VOLUME /build
